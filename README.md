# AI-Репетитор по техническим дисциплинам

AI-репетитор на основе RAG-подхода (Retrieval Augmented Generation) для помощи студентам в изучении облачных технологий Cloud.ru.

**Разработано в рамках хакатона Cloud.ru**

## Возможности

- Интерактивный чат с AI-репетитором
- Поиск релевантной информации в базе знаний
- Отображение источников использованной информации
- Генерация вопросов для самопроверки
- История диалога в рамках сессии
- Рекомендации связанных тем

## Архитектура

### Общая схема

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Streamlit     │────▶│   RAG Engine     │────▶│   OpenAI API    │
│   (app.py)      │     │  (rag_engine.py) │     │   GPT-4o        │
└─────────────────┘     └──────────────────┘     └─────────────────┘
                               │
                               ▼
                        ┌──────────────────┐
                        │   FAISS Index    │
                        │  (vector_store)  │
                        └──────────────────┘
                               ▲
                               │
                        ┌──────────────────┐
                        │ Document Loader  │
                        │(document_loader) │
                        └──────────────────┘
                               ▲
                               │
                        ┌──────────────────┐
                        │  Knowledge Base  │
                        │   (markdown)     │
                        └──────────────────┘
```

### Компоненты системы

| Компонент | Файл | Описание |
|-----------|------|----------|
| **Web Interface** | `app.py` | Streamlit чат-интерфейс с историей диалога |
| **RAG Engine** | `rag_engine.py` | Векторный поиск и генерация ответов |
| **Document Loader** | `document_loader.py` | Загрузка и чанкинг документов |
| **Logger** | `logger.py` | Структурированное логирование и метрики |
| **Config** | `knowledge_bases.json` | Конфигурация баз знаний |

### Структура проекта

```
├── app.py                  # Главное Streamlit приложение
├── rag_engine.py           # RAG движок с OpenAI
├── document_loader.py      # Загрузчик документов
├── logger.py               # Логирование и метрики
├── knowledge_bases.json    # Конфигурация баз знаний
├── knowledge_base/         # База знаний (markdown файлы)
│   ├── cloudru/
│   │   ├── ai-factory/
│   │   ├── database/
│   │   ├── containers/
│   │   └── ...
│   ├── math/               # (скоро)
│   └── informatics/        # (скоро)
├── vector_store_cloudru/   # FAISS индекс
├── .streamlit/config.toml  # Конфигурация Streamlit
└── requirements.txt        # Зависимости Python
```

## Технологический стек

| Технология | Версия | Назначение |
|------------|--------|------------|
| Python | 3.11 | Язык программирования |
| Streamlit | latest | Веб-интерфейс |
| LangChain | latest | RAG пайплайн |
| FAISS | latest | Векторный поиск |
| OpenAI GPT-4o | - | Генерация ответов |
| OpenAI text-embedding-3-small | - | Векторизация текста |

## Описание промпта

### Системный промпт AI-репетитора

Промпт состоит из нескольких блоков:

#### 1. Роль и задача
```
Ты — AI-репетитор по техническим дисциплинам от Cloud.ru. 
Твоя задача — помогать студентам осваивать учебный материал, 
объяснять сложные темы простым языком и вовлекать их в активное обучение.
```

#### 2. Правила работы
- Отвечать на русском языке
- Давать развёрнутые, понятные объяснения
- Использовать примеры из контекста базы знаний
- Честно признавать недостаток информации

#### 3. Вовлечение студента (педагогический подход)
- Задавать 1-2 вопроса в конце каждого ответа
- Предлагать связанные темы для изучения
- Проверять понимание материала
- Поощрять любопытство и вопросы
- Предлагать практические задания

#### 4. Этические принципы
- Объективность и беспристрастность
- Фильтрация нецензурного контента
- Защита персональных данных
- Отклонение вредоносных запросов

#### 5. Контент-фильтрация
- Блокировка политических и географических тем
- Защита от prompt injection (смены роли)
- Фильтрация нецензурной лексики

#### 6. Контекст
```
Контекст из базы знаний:
{context}

Отвечай на вопрос студента, используя информацию из контекста.
```

## Быстрый старт

### Требования

- Python 3.11+
- API ключ OpenAI

### Установка

1. **Клонируйте репозиторий**
```bash
git clone https://github.com/your-username/ai-tutor-cloudru.git
cd ai-tutor-cloudru
```

2. **Создайте виртуальное окружение**
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# или
venv\Scripts\activate     # Windows
```

3. **Установите зависимости**
```bash
pip install streamlit langchain langchain-openai langchain-community faiss-cpu openai tiktoken python-dotenv
```

4. **Настройте переменные окружения**

Создайте файл `.env` в корне проекта:
```env
OPENAI_API_KEY=your_openai_api_key_here
```

Или экспортируйте напрямую:
```bash
export OPENAI_API_KEY=your_openai_api_key_here
```

5. **Запустите приложение**
```bash
streamlit run app.py --server.port 5000
```

6. **Откройте в браузере**
```
http://localhost:5000
```

## Добавление новых предметов

1. Создайте папку в `knowledge_base/` (например, `knowledge_base/physics/`)

2. Добавьте markdown файлы с учебными материалами

3. Добавьте запись в `knowledge_bases.json`:
```json
{
  "id": "physics",
  "name": "Физика",
  "path": "knowledge_base/physics",
  "enabled": true,
  "description": "Курс физики"
}
```

4. Перезапустите приложение

## Безопасность, логирование и мониторинг

### Логирование (`logger.py`)

Система использует структурированное JSON-логирование для удобного анализа и мониторинга.

**Формат логов:**
```json
{
  "timestamp": "2024-01-15T10:30:45.123Z",
  "level": "INFO",
  "logger": "ai_tutor",
  "message": "User query received",
  "query_length": 45,
  "kb": "cloudru",
  "history_length": 3
}
```

**Что логируется:**
- Инициализация RAG-движка и загрузка векторного хранилища
- Входящие запросы пользователей (без содержимого для приватности)
- Время выполнения запросов
- Количество найденных источников
- Ошибки с типом исключения (без технических деталей для пользователя)

**Файлы логов:**
- `app.log` — основной файл логов
- Консольный вывод — дублирование для отладки

### Валидация ввода
- Проверка длины запроса (2-2000 символов)
- Защита от пустых и слишком коротких запросов
- Санитизация сообщений об ошибках (пользователь не видит технические детали)

### Метрики (`MetricsCollector`)

Встроенный сборщик метрик отслеживает:
- Общее количество запросов
- Количество ошибок
- Среднее время ответа
- Количество нарушений контент-фильтра
- Время работы сессии

```python
metrics.get_stats()
# {
#   "total_requests": 15,
#   "error_count": 1,
#   "avg_response_time_sec": 2.34,
#   "guard_violations": 0,
#   "uptime_sec": 3600.5
# }
```

### Обработка ошибок

Ошибки преобразуются в понятные пользователю сообщения:
- API/Auth ошибки → "Ошибка подключения к сервису"
- Timeout/Connection → "Сервис временно недоступен"
- Rate limit → "Превышен лимит запросов"

## Темы базы знаний Cloud.ru

- AI Factory (Managed RAG, Foundation Models, ML)
- Базы данных (PostgreSQL, Redis)
- Контейнеры (Kubernetes)
- Брокеры сообщений (Kafka, Spark)
- Сети (VPN, VPC)
- Мониторинг и логирование

## Лицензия

MIT License

## Авторы

Разработано для хакатона Cloud.ru
