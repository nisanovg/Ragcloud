---
title: Построение графика с PostgreSQL
source: Cloud.ru Evolution Tutorials
url: https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql
topic: dataplatform
---
# Построение графика с PostgreSQL

С помощью этого руководства вы научитесь использовать платформу Superset для создания графиков на основе данных из [Managed PostgreSQL](https://cloud.ru/docs/paas-postgresql/ug/index)Managed PostgreSQL.

В качестве примера вы построите две столбчатые диаграммы, отражающие количество мужчин и женщин среди клиентов и их средний возраст.

Вы будете использовать следующие сервисы:

- [Managed BI](https://cloud.ru/docs/managed-bi/ug/index)Managed BI — сервис для визуализации и анализа данных.
- [Managed PostgreSQL](https://cloud.ru/docs/paas-postgresql/ug/index)Managed PostgreSQL — управляемая база данных PostgreSQL.
- [Managed Trino](https://cloud.ru/docs/trino/ug/index)Managed Trino — сервис, который предоставляет массивно-параллельный аналитический SQL-движок для обработки больших объемов данных из разных источников.

[Managed BI](https://cloud.ru/docs/managed-bi/ug/index)Managed BI — сервис для визуализации и анализа данных.

[Managed PostgreSQL](https://cloud.ru/docs/paas-postgresql/ug/index)Managed PostgreSQL — управляемая база данных PostgreSQL.

[Managed Trino](https://cloud.ru/docs/trino/ug/index)Managed Trino — сервис, который предоставляет массивно-параллельный аналитический SQL-движок для обработки больших объемов данных из разных источников.

Шаги:

1. [Подготовьте инстанс Managed Trino](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Подготовьте инстанс Managed Trino.
2. [Загрузите данные в Managed PostgreSQL](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Загрузите данные в Managed PostgreSQL.
3. [Создайте подключение в Superset](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте подключение в Superset.
4. [Создайте график, отражающий пол клиентов](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте график, отражающий пол клиентов.
5. [Создайте график, отражающий пол и средний возраст клиентов](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте график, отражающий пол и средний возраст клиентов.
6. [Создайте дашборд](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте дашборд.

[Подготовьте инстанс Managed Trino](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Подготовьте инстанс Managed Trino.

[Загрузите данные в Managed PostgreSQL](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Загрузите данные в Managed PostgreSQL.

[Создайте подключение в Superset](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте подключение в Superset.

[Создайте график, отражающий пол клиентов](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте график, отражающий пол клиентов.

[Создайте график, отражающий пол и средний возраст клиентов](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте график, отражающий пол и средний возраст клиентов.

[Создайте дашборд](https://cloud.ru/docs/tutorials-evolution/list/topics/managed-bi__superset-postgresql)Создайте дашборд.

## Перед началом работы

Располагайте все создаваемые сущности в одной сети VPC и используйте единые сетевые настройки.

1. [Зарегистрируйтесь в личном кабинете Cloud.ru](https://cloud.ru/docs/console/ug/topics/guides__registration)Зарегистрируйтесь в личном кабинете Cloud.ru.
Если вы уже зарегистрированы, [войдите под своей учетной записью](https://cloud.ru/docs/console/ug/topics/guides__auth)войдите под своей учетной записью.
2. [Создайте секрет](https://cloud.ru/docs/scsm/ug/topics/guides__add-secret)Создайте секрет.
В качестве значения в поле Стандартный режим задайте пароль.
3. [Создайте группу безопасности](https://cloud.ru/docs/security-groups/ug/topics/guides__create-sg)Создайте группу безопасности.
Добавьте правила входящего и исходящего трафика со следующими параметрами:

Протокол — Любой.
Порт — оставьте незаполненным. При этом будут автоматически выбраны все порты.
Тип источника — IP-адрес.
Источник — 0.0.0.0/0.

ПримечаниеПравила с такими параметрами разрешают входящий и исходящий трафик между любыми машинами в вашей сети и любыми адресами в интернете.
В целях безопасности рекомендуем использовать их только для выполнения практических заданий.
Для работы с актуальными данными указывайте порт или диапазон портов, отдельные IP-адреса или небольшие диапазоны адресов.
4. [Создайте публичный SNAT-шлюз](https://cloud.ru/docs/gateways/ug/topics/guides__create-gw)Создайте публичный SNAT-шлюз.
5. [Настройте DNS-сервер и подсеть](https://cloud.ru/docs/dataplatform/ug/topics/guides__dns)Настройте DNS-сервер и подсеть.
6. [Скачайте и установите root-сертификат](https://cloud.ru/docs/dataplatform/ug/topics/guides__root-certificate)Скачайте и установите root-сертификат на устройство.
7. [Создайте кластер Data Platform](https://cloud.ru/docs/dataplatform/ug/topics/guides__create)Создайте кластер Data Platform, назовите его «dp-labs».
8. [Создайте кластер Managed PostgreSQL®](https://cloud.ru/docs/paas-postgresql/ug/topics/guides__cluster-creation)Создайте кластер Managed PostgreSQL®.

Задайте название кластера «DBaaS-PG-1».
Дождитесь, когда статус кластера изменится на «Доступен».
9. [Создайте инстанс Managed BI](https://cloud.ru/docs/managed-bi/ug/topics/guides__instance-creation)Создайте инстанс Managed BI.

В блоке Конфигурация выберите Вычислительные ресурсы — [2 vCPU / 4 RAM (free tier)](https://cloud.ru/docs/managed-bi/ug/topics/overview__free-tier)2 vCPU / 4 RAM (free tier).
Активируйте опцию Подключить публичный хост.
В блоке Сетевые настройки в поле Группа безопасности выберите созданную ранее группу безопасности.
Дождитесь, когда статус инстанса изменится на «Готов».
10. Установите JDBC-клиент DBeaver.

[Зарегистрируйтесь в личном кабинете Cloud.ru](https://cloud.ru/docs/console/ug/topics/guides__registration)Зарегистрируйтесь в личном кабинете Cloud.ru.

Если вы уже зарегистрированы, [войдите под своей учетной записью](https://cloud.ru/docs/console/ug/topics/guides__auth)войдите под своей учетной записью.

[Создайте секрет](https://cloud.ru/docs/scsm/ug/topics/guides__add-secret)Создайте секрет.
В качестве значения в поле Стандартный режим задайте пароль.

[Создайте группу безопасности](https://cloud.ru/docs/security-groups/ug/topics/guides__create-sg)Создайте группу безопасности.
Добавьте правила входящего и исходящего трафика со следующими параметрами:

- Протокол — Любой.
- Порт — оставьте незаполненным. При этом будут автоматически выбраны все порты.
- Тип источника — IP-адрес.
- Источник — 0.0.0.0/0.

Протокол — Любой.

Порт — оставьте незаполненным. При этом будут автоматически выбраны все порты.

Тип источника — IP-адрес.

Источник — 0.0.0.0/0.

Правила с такими параметрами разрешают входящий и исходящий трафик между любыми машинами в вашей сети и любыми адресами в интернете.
В целях безопасности рекомендуем использовать их только для выполнения практических заданий.
Для работы с актуальными данными указывайте порт или диапазон портов, отдельные IP-адреса или небольшие диапазоны адресов.

[Создайте публичный SNAT-шлюз](https://cloud.ru/docs/gateways/ug/topics/guides__create-gw)Создайте публичный SNAT-шлюз.

[Настройте DNS-сервер и подсеть](https://cloud.ru/docs/dataplatform/ug/topics/guides__dns)Настройте DNS-сервер и подсеть.

[Скачайте и установите root-сертификат](https://cloud.ru/docs/dataplatform/ug/topics/guides__root-certificate)Скачайте и установите root-сертификат на устройство.

[Создайте кластер Data Platform](https://cloud.ru/docs/dataplatform/ug/topics/guides__create)Создайте кластер Data Platform, назовите его «dp-labs».

[Создайте кластер Managed PostgreSQL®](https://cloud.ru/docs/paas-postgresql/ug/topics/guides__cluster-creation)Создайте кластер Managed PostgreSQL®.

1. Задайте название кластера «DBaaS-PG-1».
2. Дождитесь, когда статус кластера изменится на «Доступен».

Задайте название кластера «DBaaS-PG-1».

Дождитесь, когда статус кластера изменится на «Доступен».

[Создайте инстанс Managed BI](https://cloud.ru/docs/managed-bi/ug/topics/guides__instance-creation)Создайте инстанс Managed BI.

1. В блоке Конфигурация выберите Вычислительные ресурсы — [2 vCPU / 4 RAM (free tier)](https://cloud.ru/docs/managed-bi/ug/topics/overview__free-tier)2 vCPU / 4 RAM (free tier).
2. Активируйте опцию Подключить публичный хост.
3. В блоке Сетевые настройки в поле Группа безопасности выберите созданную ранее группу безопасности.
4. Дождитесь, когда статус инстанса изменится на «Готов».

В блоке Конфигурация выберите Вычислительные ресурсы — [2 vCPU / 4 RAM (free tier)](https://cloud.ru/docs/managed-bi/ug/topics/overview__free-tier)2 vCPU / 4 RAM (free tier).

Активируйте опцию Подключить публичный хост.

В блоке Сетевые настройки в поле Группа безопасности выберите созданную ранее группу безопасности.

Дождитесь, когда статус инстанса изменится на «Готов».

Установите JDBC-клиент DBeaver.

## 1. Подготовьте инстанс Managed Trino

На этом шаге вы создадите инстанс Managed Trino и подключитесь к нему с помощью DBeaver.

1. Откройте карточку кластера Managed PostgreSQL®.
Информация из нее понадобится на следующих этапах.
2. В новой вкладке браузера откройте сервис Managed Trino.
3. Нажмите Создать и выберите Каталог.
4. Заполните поля:

Название — postgres.
Коннектор — postgresql.
Хост — внутренний IP, указанный в карточке созданного ранее кластера DBaaS-PG-1.
Порт — порт, указанный в карточке кластера DBaaS-PG-1.
Название базы данных — dbaas_pg_1.
Логин — логин, указанный в карточке кластера DBaaS-PG-1.
Пароль — пароль, сохраненный в [Secret Management](https://cloud.ru/docs/scsm/ug/index)Secret Management.
5. Нажмите Создать.
6. Перейдите в раздел Инстансы и нажмите Создать инстанс.
7. В блоке Общие параметры укажите:

Название — trino-instance.
Кластер — dp-labs.
8. В блоке Конфигурация выберите:

Вычислительные ресурсы — 4 vCPU/16 RAM.
Количество нод — 3.
Чтобы указать количество нод, отключите опцию Автомасштабирование.
9. В блоке Настройки каталога выберите каталог postgres.
10. Нажмите Продолжить.
11. В блоке Сетевые настройки:

Зона доступности — выберите задействованную на предыдущих шагах [зону доступности](https://cloud.ru/docs/glossary/list/index)зону доступности, .
Подсеть — выберите задействованную на предыдущих шагах подсеть.
12. В блоке Настройки доступа:

Подключить публичный хост — активируйте опцию.
Пользователь — введите имя пользователя.
Пароль — пароль, сохраненный в [Secret Management](https://cloud.ru/docs/scsm/ug/index)Secret Management.
13. Нажмите Создать.
14. Дождитесь, когда статус инстанса изменится на «Готов».
15. Откройте карточку инстанса Managed Trino.
Информация из нее понадобится на следующих этапах.
16. [Подключите инстанс Managed Trino к клиенту JDBC](https://cloud.ru/docs/trino/ug/topics/guides__instance-jdbc)Подключите инстанс Managed Trino к клиенту JDBC.

Откройте карточку кластера Managed PostgreSQL®.
Информация из нее понадобится на следующих этапах.

В новой вкладке браузера откройте сервис Managed Trino.

Нажмите Создать и выберите Каталог.

Заполните поля:

- Название — postgres.
- Коннектор — postgresql.
- Хост — внутренний IP, указанный в карточке созданного ранее кластера DBaaS-PG-1.
- Порт — порт, указанный в карточке кластера DBaaS-PG-1.
- Название базы данных — dbaas_pg_1.
- Логин — логин, указанный в карточке кластера DBaaS-PG-1.
- Пароль — пароль, сохраненный в [Secret Management](https://cloud.ru/docs/scsm/ug/index)Secret Management.

Название — postgres.

Коннектор — postgresql.

Хост — внутренний IP, указанный в карточке созданного ранее кластера DBaaS-PG-1.

Порт — порт, указанный в карточке кластера DBaaS-PG-1.

Название базы данных — dbaas_pg_1.

Логин — логин, указанный в карточке кластера DBaaS-PG-1.

Пароль — пароль, сохраненный в [Secret Management](https://cloud.ru/docs/scsm/ug/index)Secret Management.

Нажмите Создать.

Перейдите в раздел Инстансы и нажмите Создать инстанс.

В блоке Общие параметры укажите:

- Название — trino-instance.
- Кластер — dp-labs.

Название — trino-instance.

Кластер — dp-labs.

В блоке Конфигурация выберите:

- Вычислительные ресурсы — 4 vCPU/16 RAM.
- Количество нод — 3.
Чтобы указать количество нод, отключите опцию Автомасштабирование.

Вычислительные ресурсы — 4 vCPU/16 RAM.

Количество нод — 3.
Чтобы указать количество нод, отключите опцию Автомасштабирование.

В блоке Настройки каталога выберите каталог postgres.

Нажмите Продолжить.

В блоке Сетевые настройки:

- Зона доступности — выберите задействованную на предыдущих шагах [зону доступности](https://cloud.ru/docs/glossary/list/index)зону доступности, .
- Подсеть — выберите задействованную на предыдущих шагах подсеть.

Зона доступности — выберите задействованную на предыдущих шагах

Подсеть — выберите задействованную на предыдущих шагах подсеть.

В блоке Настройки доступа:

- Подключить публичный хост — активируйте опцию.
- Пользователь — введите имя пользователя.
- Пароль — пароль, сохраненный в [Secret Management](https://cloud.ru/docs/scsm/ug/index)Secret Management.

Подключить публичный хост — активируйте опцию.

Пользователь — введите имя пользователя.

Пароль — пароль, сохраненный в [Secret Management](https://cloud.ru/docs/scsm/ug/index)Secret Management.

Нажмите Создать.

Дождитесь, когда статус инстанса изменится на «Готов».

Откройте карточку инстанса Managed Trino.
Информация из нее понадобится на следующих этапах.

[Подключите инстанс Managed Trino к клиенту JDBC](https://cloud.ru/docs/trino/ug/topics/guides__instance-jdbc)Подключите инстанс Managed Trino к клиенту JDBC.

## 2. Загрузите данные в Managed PostgreSQL®

На этом шаге вы загрузите в Managed PostgreSQL® данные для визуализации.

1. Скачайте таблицу [mall_customers.csv](https://xbox.cloud.ru/index.php/s/A4ri39MAwDo4HEo)mall_customers.csv.
2. В DBeaver на верхней панели выберите Редактор SQl → Открыть SQL-скрипт.
3. Скопируйте и выполните SQL-запрос:
CREATE TABLE postgres.lab.mall_customers ( customerid integer, gender varchar(50), age integer, annualincome integer, spendingscore integer);
4. В списке баз данных нажмите правой кнопкой мыши на созданную таблицу.
5. В контекстном меню выберите Импорт данных.
6. Настройте трансфер данных:

На шаге Исходный формат выберите .csv.
Укажите скачанную ранее таблицу mall_customers и нажмите Далее.
Проверьте соответствие столбцов и нажмите Далее.
На шаге Настройки загрузки данных отключите опцию Использовать транзакции и нажмите Далее.
Нажмите Продолжить.

Скачайте таблицу [mall_customers.csv](https://xbox.cloud.ru/index.php/s/A4ri39MAwDo4HEo)mall_customers.csv.

В DBeaver на верхней панели выберите Редактор SQl → Открыть SQL-скрипт.

Скопируйте и выполните SQL-запрос:

```bash
CREATE TABLE postgres.lab.mall_customers
(
customerid integer,
gender varchar
(
50
)
,
age integer,
annualincome integer,
spendingscore integer
)
;
```

В списке баз данных нажмите правой кнопкой мыши на созданную таблицу.

В контекстном меню выберите Импорт данных.

Настройте трансфер данных:

1. На шаге Исходный формат выберите .csv.
2. Укажите скачанную ранее таблицу mall_customers и нажмите Далее.
3. Проверьте соответствие столбцов и нажмите Далее.
4. На шаге Настройки загрузки данных отключите опцию Использовать транзакции и нажмите Далее.
5. Нажмите Продолжить.

На шаге Исходный формат выберите .csv.

Укажите скачанную ранее таблицу mall_customers и нажмите Далее.

Проверьте соответствие столбцов и нажмите Далее.

На шаге Настройки загрузки данных отключите опцию Использовать транзакции и нажмите Далее.

Нажмите Продолжить.

## 3. Создайте подключение в Superset

На этом шаге вы настроите платформу Superset для визуализации данных.

1. Перейдите в раздел Evolution и выберите сервис Managed BI.
2. В карточке созданного ранее инстанса нажмите Перейти в интерфейс BI.
3. Нажмите Sign in with cloud.
4. Справа сверху нажмите Настройки и выберите Данные → Подключения.
5. Справа сверху нажмите База данных.
6. В поле Поддерживаемые базы данных выберите Trino с помощью поиска.
7. В поле SQLAlchemy URI введите данные инстанса Managed Trino в формате trino://<username>:<password>@<host>:<port>/<catalog>, где:

<username> — имя пользователя, поле Пользователь в карточке инстанса Managed Trino.
<password> — пароль, поле Пароль в карточке инстанса Managed Trino.
<host> — внутренний хост из карточки инстанса Managed Trino.
<port> — порт из карточки инстанса Managed Trino.
<catalog> — postgres.
8. Нажмите Подключить.
Подключение появится в списке Базы данных.

Перейдите в раздел Evolution и выберите сервис Managed BI.

В карточке созданного ранее инстанса нажмите Перейти в интерфейс BI.

Нажмите Sign in with cloud.

Справа сверху нажмите Настройки и выберите Данные → Подключения.

Справа сверху нажмите База данных.

В поле Поддерживаемые базы данных выберите Trino с помощью поиска.

В поле SQLAlchemy URI введите данные инстанса Managed Trino в формате trino://<username>:<password>@<host>:<port>/<catalog>, где:

- <username> — имя пользователя, поле Пользователь в карточке инстанса Managed Trino.
- <password> — пароль, поле Пароль в карточке инстанса Managed Trino.
- <host> — внутренний хост из карточки инстанса Managed Trino.
- <port> — порт из карточки инстанса Managed Trino.
- <catalog> — postgres.

<username> — имя пользователя, поле Пользователь в карточке инстанса Managed Trino.

<password> — пароль, поле Пароль в карточке инстанса Managed Trino.

<host> — внутренний хост из карточки инстанса Managed Trino.

<port> — порт из карточки инстанса Managed Trino.

<catalog> — postgres.

Нажмите Подключить.
Подключение появится в списке Базы данных.

## 4. Создайте график, отражающий пол клиентов

На этом шаге вы создадите график, который отобразит количество мужчин и женщин среди клиентов.

1. Перейдите на вкладку Датасеты.
2. Справа сверху нажмите Датасет.
3. Заполните поля:

База данных — Trino.
Схема — lab.
Tаблица — mall_customers.
4. Нажмите Создать датасет и диаграмму.
5. В блоке Выберите тип диаграммы с помощью поиска выберите тип Столбчатая диаграмма.
6. В правом нижнем углу нажмите Создать диаграмму.
7. Перетащите столбец gender в поле Ось Х.
8. Перетащите столбец gender в поле Mеры.
9. В открывшемся окне в поле Агрегатная функция выберите COUNT и нажмите Сохранить.
10. Нажмите Создать диаграмму.
11. Справа сверху нажмите Сохранить и подтвердите сохранение.

Перейдите на вкладку Датасеты.

Справа сверху нажмите Датасет.

Заполните поля:

- База данных — Trino.
- Схема — lab.
- Tаблица — mall_customers.

База данных — Trino.

Схема — lab.

Tаблица — mall_customers.

Нажмите Создать датасет и диаграмму.

В блоке Выберите тип диаграммы с помощью поиска выберите тип Столбчатая диаграмма.

В правом нижнем углу нажмите Создать диаграмму.

Перетащите столбец gender в поле Ось Х.

Перетащите столбец gender в поле Mеры.

В открывшемся окне в поле Агрегатная функция выберите COUNT и нажмите Сохранить.

Нажмите Создать диаграмму.

Справа сверху нажмите Сохранить и подтвердите сохранение.

## 5. Создайте график, отражающий пол и средний возраст клиентов

На этом шаге вы создадите график, который отобразит количество мужчин и женщин среди клиентов и их средний возраст.

1. Справа сверху нажмите Диаграмма.
2. В блоке Выберите датасет выберите mall_customers.
3. В блоке Выберите тип диаграммы с помощью поиска найдите и выберите тип Столбчатая диаграмма.
4. В правом нижнем углу нажмите Создать диаграмму.
5. Перетащите столбец gender в поле Ось Х.
6. Перетащите столбец age в поле Mеры.
7. В открывшемся окне в поле Агрегатная функция выберите AVG и нажмите Сохранить.
8. Нажмите Создать диаграмму.
9. Справа сверху нажмите Сохранить и подтвердите сохранение.

Справа сверху нажмите Диаграмма.

В блоке Выберите датасет выберите mall_customers.

В блоке Выберите тип диаграммы с помощью поиска найдите и выберите тип Столбчатая диаграмма.

В правом нижнем углу нажмите Создать диаграмму.

Перетащите столбец gender в поле Ось Х.

Перетащите столбец age в поле Mеры.

В открывшемся окне в поле Агрегатная функция выберите AVG и нажмите Сохранить.

Нажмите Создать диаграмму.

Справа сверху нажмите Сохранить и подтвердите сохранение.

## 6. Создайте дашборд

На этом шаге вы соберете созданные ранее графики на дашборд.

1. В Superset перейдите на вкладку Дашборды.
2. Справа сверху нажмите Дашборд.
3. Из списка справа перетащите ранее созданные графики в рабочую область слева.
4. Нажмите Сохранить.

В Superset перейдите на вкладку Дашборды.

Справа сверху нажмите Дашборд.

Из списка справа перетащите ранее созданные графики в рабочую область слева.

Нажмите Сохранить.

## Результат

Вы научились подключать к сервису Managed BI данные, размещенные в Managed PostgreSQL®, и использовать платформу Superset для построения графиков.
