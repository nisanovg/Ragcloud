---
title: Связывание ресурсов разных VPC из разных проектов
source: Cloud.ru Evolution Tutorials
url: https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects
topic: network
---
# Связывание ресурсов разных VPC из разных проектов

С помощью этого руководства вы создадите связность между виртуальными машинами из разных

![Схема связности ресурсов в разных VPC из разных проектов](https://cloud.ru/docs/api/cdn/tutorials-evolution/list/_images/sch__vpcs-in-projects.png)

Вы будете использовать следующие сервисы:

- [Виртуальные машины](https://cloud.ru/docs/virtual-machines/ug/index)Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.
- [VPC](https://cloud.ru/docs/evolution-vpc/ug/index)VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.
- [Подсети](https://cloud.ru/docs/subnets/ug/index)Подсети — часть облачной сети, которая изолирована от других подобных сетей.
- [Magic Router](https://cloud.ru/docs/magic-router/ug/index)Magic Router — сервис для управления сетевыми связями между ресурсами внутри облачной инфраструктуры.
- [Группы безопасности](https://cloud.ru/docs/security-groups/ug/index)Группы безопасности — сервис для контроля трафика виртуальных машин.

[Виртуальные машины](https://cloud.ru/docs/virtual-machines/ug/index)Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.

[VPC](https://cloud.ru/docs/evolution-vpc/ug/index)VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.

[Подсети](https://cloud.ru/docs/subnets/ug/index)Подсети — часть облачной сети, которая изолирована от других подобных сетей.

[Magic Router](https://cloud.ru/docs/magic-router/ug/index)Magic Router — сервис для управления сетевыми связями между ресурсами внутри облачной инфраструктуры.

[Группы безопасности](https://cloud.ru/docs/security-groups/ug/index)Группы безопасности — сервис для контроля трафика виртуальных машин.

Шаги:

1. [Подготовьте среду](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Подготовьте среду.
2. [Создайте соединение между VPC и Magic Router](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Создайте соединение между VPC и Magic Router.
3. [Создайте соединение Magic Link](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Создайте соединение Magic Link.
4. [Настройте маршруты на Magic Router](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Настройте маршруты на Magic Router.
5. [Настройте маршруты для VPC](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Настройте маршруты для VPC.
6. [Настройте правила групп безопасности](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Настройте правила групп безопасности.
7. [Проверьте сетевую связность](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Проверьте сетевую связность.

[Подготовьте среду](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Подготовьте среду.

[Создайте соединение между VPC и Magic Router](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Создайте соединение между VPC и Magic Router.

[Создайте соединение Magic Link](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Создайте соединение Magic Link.

[Настройте маршруты на Magic Router](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Настройте маршруты на Magic Router.

[Настройте маршруты для VPC](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Настройте маршруты для VPC.

[Настройте правила групп безопасности](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Настройте правила групп безопасности.

[Проверьте сетевую связность](https://cloud.ru/docs/tutorials-evolution/list/topics/magic-router__link-vpcs-in-two-projects)Проверьте сетевую связность.

## Перед началом работы

1. [Зарегистрируйтесь в личном кабинете Cloud.ru](https://cloud.ru/docs/console/ug/topics/guides__registration)Зарегистрируйтесь в личном кабинете Cloud.ru.
Если вы уже зарегистрированы, [войдите под своей учетной записью](https://cloud.ru/docs/console/ug/topics/guides__auth)войдите под своей учетной записью.
2. [Создайте и загрузите SSH-ключ в облако](https://cloud.ru/docs/public-keys/ug/topics/guides__generate-key)Создайте и загрузите SSH-ключ в облако.

[Зарегистрируйтесь в личном кабинете Cloud.ru](https://cloud.ru/docs/console/ug/topics/guides__registration)Зарегистрируйтесь в личном кабинете Cloud.ru.

Если вы уже зарегистрированы, [войдите под своей учетной записью](https://cloud.ru/docs/console/ug/topics/guides__auth)войдите под своей учетной записью.

[Создайте и загрузите SSH-ключ в облако](https://cloud.ru/docs/public-keys/ug/topics/guides__generate-key)Создайте и загрузите SSH-ключ в облако.

## 1. Подготовьте среду

1. [Создайте две VPC-сети](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-vpc)Создайте две VPC-сети:

В проекте 1 VPC-1.
В проекте 2 VPC-2.
2. [Создайте три подсети](https://cloud.ru/docs/subnets/ug/topics/guides__create-subnet)Создайте три подсети — две в VPC-1 и одну в VPC-2:

Подсеть subnet-1 в VPC-1 в [зоне доступности](https://cloud.ru/docs/glossary/list/index)зоне доступности ru.AZ-1:

Название: subnet-1.
VPC: VPC-1.
Зона доступности: ru.AZ-1.
Адрес: 10.1.1.0/24.

Подсеть subnet-2 в VPC-1 в зоне доступности ru.AZ-2:

Название: subnet-2.
VPC: VPC-1.
Зона доступности: ru.AZ-2.
Адрес: 10.3.3.0/24.

Подсеть subnet-3 в VPC-2 в зоне доступности ru.AZ-1:

Название: subnet-3.
VPC: VPC-2.
Зона доступности: ru.AZ-1.
Адрес: 10.2.2.0/24.

Убедитесь, что:

В проекте 1 → Сеть → VPC для VPC-1 подсети subnet-1, subnet-2 отображаются в статусе «Создана».
В проекте 2 → Сеть → VPC для VPC-2 подсеть subnet-3 отображается в статусе «Создана».
3. [Создайте три ВМ](https://cloud.ru/docs/virtual-machines/ug/topics/guides__create-vm)Создайте три ВМ — две в VPC-1 и одну в VPC-2:

vm-1 в VPC-1 и подсети subnet-1:

Название: vm-1.
Зона доступности: ru.AZ-1.
Образ: Публичные → Ubuntu 22.04.
Гарантированная доля vCPU: 10%.
vCPU: 1.
RAM: 1.
VPC: VPC-1.
Подсеть: 10.1.1.0/24 (subnet-1).
Внутренний IP: Автоматически.
Группы безопасности: SSH-access_ru.AZ-1.
Метод аутентификации: Публичный ключ и пароль.
Публичный ключ: ваш SSH-ключ.
Пароль: ваш пароль.
Имя хоста: vm-1.

vm-2 в VPC-1 и подсети subnet-2:

Название: vm-2.
Зона доступности: ru.AZ-2.
Образ: Публичные → Ubuntu 22.04.
Гарантированная доля vCPU: 10%.
vCPU: 1.
RAM: 1.
VPC: VPC-1.
Подсеть: 10.3.3.0/24 (subnet-2).
Внутренний IP: Автоматически.
Группы безопасности: SSH-access_ru.AZ-2.
Метод аутентификации: Публичный ключ и пароль.
Публичный ключ: ваш SSH-ключ.
Пароль: ваш пароль.
Имя хоста: vm-2.

vm-3 в VPC-2 и подсети subnet-3:

Название: vm-3.
Зона доступности: ru.AZ-1.
Образ: Публичные → Ubuntu 22.04.
Гарантированная доля vCPU: 10%.
vCPU: 1.
RAM: 1.
VPC: VPC-2.
Подсеть: 10.2.2.0/24 (subnet-3).
Внутренний IP: Автоматически.
Группы безопасности: SSH-access_ru.AZ-1.
Метод аутентификации: Публичный ключ и пароль.
Публичный ключ: ваш SSH-ключ.
Пароль: ваш пароль.
Имя хоста: vm-3.

Убедитесь, что:

В проекте 1 → Инфраструктура → Виртуальные машины виртуальные машины vm-1 и vm-2 отображаются в статусе «Запущена».
В проекте 2 → Инфраструктура → Виртуальные машины виртуальная машина vm-3 отображается в статусе «Запущена»

[Создайте две VPC-сети](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-vpc)Создайте две VPC-сети:

1. В проекте 1 VPC-1.
2. В проекте 2 VPC-2.

В проекте 1 VPC-1.

В проекте 2 VPC-2.

[Создайте три подсети](https://cloud.ru/docs/subnets/ug/topics/guides__create-subnet)Создайте три подсети — две в VPC-1 и одну в VPC-2:

1. Подсеть subnet-1 в VPC-1 в [зоне доступности](https://cloud.ru/docs/glossary/list/index)зоне доступности ru.AZ-1:

Название: subnet-1.
VPC: VPC-1.
Зона доступности: ru.AZ-1.
Адрес: 10.1.1.0/24.
2. Подсеть subnet-2 в VPC-1 в зоне доступности ru.AZ-2:

Название: subnet-2.
VPC: VPC-1.
Зона доступности: ru.AZ-2.
Адрес: 10.3.3.0/24.
3. Подсеть subnet-3 в VPC-2 в зоне доступности ru.AZ-1:

Название: subnet-3.
VPC: VPC-2.
Зона доступности: ru.AZ-1.
Адрес: 10.2.2.0/24.

Подсеть subnet-1 в VPC-1 в

- Название: subnet-1.
- VPC: VPC-1.
- Зона доступности: ru.AZ-1.
- Адрес: 10.1.1.0/24.

Название: subnet-1.

VPC: VPC-1.

Зона доступности: ru.AZ-1.

Адрес: 10.1.1.0/24.

Подсеть subnet-2 в VPC-1 в зоне доступности ru.AZ-2:

- Название: subnet-2.
- VPC: VPC-1.
- Зона доступности: ru.AZ-2.
- Адрес: 10.3.3.0/24.

Название: subnet-2.

VPC: VPC-1.

Зона доступности: ru.AZ-2.

Адрес: 10.3.3.0/24.

Подсеть subnet-3 в VPC-2 в зоне доступности ru.AZ-1:

- Название: subnet-3.
- VPC: VPC-2.
- Зона доступности: ru.AZ-1.
- Адрес: 10.2.2.0/24.

Название: subnet-3.

VPC: VPC-2.

Зона доступности: ru.AZ-1.

Адрес: 10.2.2.0/24.

Убедитесь, что:

- В проекте 1 → Сеть → VPC для VPC-1 подсети subnet-1, subnet-2 отображаются в статусе «Создана».
- В проекте 2 → Сеть → VPC для VPC-2 подсеть subnet-3 отображается в статусе «Создана».

В проекте 1 → Сеть → VPC для VPC-1 подсети subnet-1, subnet-2 отображаются в статусе «Создана».

В проекте 2 → Сеть → VPC для VPC-2 подсеть subnet-3 отображается в статусе «Создана».

[Создайте три ВМ](https://cloud.ru/docs/virtual-machines/ug/topics/guides__create-vm)Создайте три ВМ — две в VPC-1 и одну в VPC-2:

1. vm-1 в VPC-1 и подсети subnet-1:

Название: vm-1.
Зона доступности: ru.AZ-1.
Образ: Публичные → Ubuntu 22.04.
Гарантированная доля vCPU: 10%.
vCPU: 1.
RAM: 1.
VPC: VPC-1.
Подсеть: 10.1.1.0/24 (subnet-1).
Внутренний IP: Автоматически.
Группы безопасности: SSH-access_ru.AZ-1.
Метод аутентификации: Публичный ключ и пароль.
Публичный ключ: ваш SSH-ключ.
Пароль: ваш пароль.
Имя хоста: vm-1.
2. vm-2 в VPC-1 и подсети subnet-2:

Название: vm-2.
Зона доступности: ru.AZ-2.
Образ: Публичные → Ubuntu 22.04.
Гарантированная доля vCPU: 10%.
vCPU: 1.
RAM: 1.
VPC: VPC-1.
Подсеть: 10.3.3.0/24 (subnet-2).
Внутренний IP: Автоматически.
Группы безопасности: SSH-access_ru.AZ-2.
Метод аутентификации: Публичный ключ и пароль.
Публичный ключ: ваш SSH-ключ.
Пароль: ваш пароль.
Имя хоста: vm-2.
3. vm-3 в VPC-2 и подсети subnet-3:

Название: vm-3.
Зона доступности: ru.AZ-1.
Образ: Публичные → Ubuntu 22.04.
Гарантированная доля vCPU: 10%.
vCPU: 1.
RAM: 1.
VPC: VPC-2.
Подсеть: 10.2.2.0/24 (subnet-3).
Внутренний IP: Автоматически.
Группы безопасности: SSH-access_ru.AZ-1.
Метод аутентификации: Публичный ключ и пароль.
Публичный ключ: ваш SSH-ключ.
Пароль: ваш пароль.
Имя хоста: vm-3.

vm-1 в VPC-1 и подсети subnet-1:

- Название: vm-1.
- Зона доступности: ru.AZ-1.
- Образ: Публичные → Ubuntu 22.04.
- Гарантированная доля vCPU: 10%.
- vCPU: 1.
- RAM: 1.
- VPC: VPC-1.
- Подсеть: 10.1.1.0/24 (subnet-1).
- Внутренний IP: Автоматически.
- Группы безопасности: SSH-access_ru.AZ-1.
- Метод аутентификации: Публичный ключ и пароль.
- Публичный ключ: ваш SSH-ключ.
- Пароль: ваш пароль.
- Имя хоста: vm-1.

Название: vm-1.

Зона доступности: ru.AZ-1.

Образ: Публичные → Ubuntu 22.04.

Гарантированная доля vCPU: 10%.

vCPU: 1.

RAM: 1.

VPC: VPC-1.

Подсеть: 10.1.1.0/24 (subnet-1).

Внутренний IP: Автоматически.

Группы безопасности: SSH-access_ru.AZ-1.

Метод аутентификации: Публичный ключ и пароль.

Публичный ключ: ваш SSH-ключ.

Пароль: ваш пароль.

Имя хоста: vm-1.

vm-2 в VPC-1 и подсети subnet-2:

- Название: vm-2.
- Зона доступности: ru.AZ-2.
- Образ: Публичные → Ubuntu 22.04.
- Гарантированная доля vCPU: 10%.
- vCPU: 1.
- RAM: 1.
- VPC: VPC-1.
- Подсеть: 10.3.3.0/24 (subnet-2).
- Внутренний IP: Автоматически.
- Группы безопасности: SSH-access_ru.AZ-2.
- Метод аутентификации: Публичный ключ и пароль.
- Публичный ключ: ваш SSH-ключ.
- Пароль: ваш пароль.
- Имя хоста: vm-2.

Название: vm-2.

Зона доступности: ru.AZ-2.

Образ: Публичные → Ubuntu 22.04.

Гарантированная доля vCPU: 10%.

vCPU: 1.

RAM: 1.

VPC: VPC-1.

Подсеть: 10.3.3.0/24 (subnet-2).

Внутренний IP: Автоматически.

Группы безопасности: SSH-access_ru.AZ-2.

Метод аутентификации: Публичный ключ и пароль.

Публичный ключ: ваш SSH-ключ.

Пароль: ваш пароль.

Имя хоста: vm-2.

vm-3 в VPC-2 и подсети subnet-3:

- Название: vm-3.
- Зона доступности: ru.AZ-1.
- Образ: Публичные → Ubuntu 22.04.
- Гарантированная доля vCPU: 10%.
- vCPU: 1.
- RAM: 1.
- VPC: VPC-2.
- Подсеть: 10.2.2.0/24 (subnet-3).
- Внутренний IP: Автоматически.
- Группы безопасности: SSH-access_ru.AZ-1.
- Метод аутентификации: Публичный ключ и пароль.
- Публичный ключ: ваш SSH-ключ.
- Пароль: ваш пароль.
- Имя хоста: vm-3.

Название: vm-3.

Зона доступности: ru.AZ-1.

Образ: Публичные → Ubuntu 22.04.

Гарантированная доля vCPU: 10%.

vCPU: 1.

RAM: 1.

VPC: VPC-2.

Подсеть: 10.2.2.0/24 (subnet-3).

Внутренний IP: Автоматически.

Группы безопасности: SSH-access_ru.AZ-1.

Метод аутентификации: Публичный ключ и пароль.

Публичный ключ: ваш SSH-ключ.

Пароль: ваш пароль.

Имя хоста: vm-3.

Убедитесь, что:

- В проекте 1 → Инфраструктура → Виртуальные машины виртуальные машины vm-1 и vm-2 отображаются в статусе «Запущена».
- В проекте 2 → Инфраструктура → Виртуальные машины виртуальная машина vm-3 отображается в статусе «Запущена»

В проекте 1 → Инфраструктура → Виртуальные машины виртуальные машины vm-1 и vm-2 отображаются в статусе «Запущена».

В проекте 2 → Инфраструктура → Виртуальные машины виртуальная машина vm-3 отображается в статусе «Запущена»

## 2. Создайте соединения между VPC и Magic Router

[Создайте Magic Router](https://cloud.ru/docs/magic-router/ug/topics/guides__mr-create)Создайте Magic Router в каждом из проектов и создайте соединения между VPC и Magic Router.

1. В проекте 1 создайте соединение между VPC и Magic Router.

Выберите сервис Magic Router.
Нажмите Создать Magic Router.
В Типе соединения выберите VPC Evolution.
Выберите VPC-1.
Нажмите Создать.

Убедитесь, что в проекте 1 → Сеть → Magic Router на странице Соединения отображается соединение VPC-1 в статусе «Активно».
2. В проекте 2 создайте соединение между VPC и Magic Router.

Выберите сервис Magic Router.
Нажмите Создать Magic Router.
В Типе соединения выберите VPC Evolution.
Выберите VPC-2.
Нажмите Создать.

В проекте 1 создайте соединение между VPC и Magic Router.

- Выберите сервис Magic Router.
- Нажмите Создать Magic Router.
- В Типе соединения выберите VPC Evolution.
- Выберите VPC-1.
- Нажмите Создать.

Выберите сервис Magic Router.

Нажмите Создать Magic Router.

В Типе соединения выберите VPC Evolution.

Выберите VPC-1.

Нажмите Создать.

Убедитесь, что в проекте 1 → Сеть → Magic Router на странице Соединения отображается соединение VPC-1 в статусе «Активно».

В проекте 2 создайте соединение между VPC и Magic Router.

- Выберите сервис Magic Router.
- Нажмите Создать Magic Router.
- В Типе соединения выберите VPC Evolution.
- Выберите VPC-2.
- Нажмите Создать.

Выберите сервис Magic Router.

Нажмите Создать Magic Router.

В Типе соединения выберите VPC Evolution.

Выберите VPC-2.

Нажмите Создать.

Убедитесь, что в проекте 2 → Сеть → Magic Router на странице Соединения соединение VPC-2 отображается в статусе «Активно».

## 3. Создайте соединение Magic Link

1. В проекте 2 → Сеть → Magic Router перейдите на вкладку Информация и скопируйте ID Magic Router.
2. В проекте 1 [создайте Magic Link](https://cloud.ru/docs/magic-router/ug/topics/guides__connection-add-magic-link)создайте Magic Link.

В проекте 1 выберите Сеть → Magic Router, перейдите на вкладку Соединения.
Нажмите Создать cоединение.
В Типе соединения выберите Magic Link.
Название соединения: MagicLink-1.
В поле Magic Router ID укажите идентификатор Magic Router, который получили на шаге 1 инструкции.
Нажмите Добавить.

В проекте 2 → Сеть → Magic Router перейдите на вкладку Информация и скопируйте ID Magic Router.

В проекте 1 [создайте Magic Link](https://cloud.ru/docs/magic-router/ug/topics/guides__connection-add-magic-link)создайте Magic Link.

- В проекте 1 выберите Сеть → Magic Router, перейдите на вкладку Соединения.
- Нажмите Создать cоединение.
- В Типе соединения выберите Magic Link.
- Название соединения: MagicLink-1.
- В поле Magic Router ID укажите идентификатор Magic Router, который получили на шаге 1 инструкции.
- Нажмите Добавить.

В проекте 1 выберите Сеть → Magic Router, перейдите на вкладку Соединения.

Нажмите Создать cоединение.

В Типе соединения выберите Magic Link.

Название соединения: MagicLink-1.

В поле Magic Router ID укажите идентификатор Magic Router, который получили на шаге 1 инструкции.

Нажмите Добавить.

Соединение будет создано со статусом «Ожидает подтверждения».
Дождитесь, когда в проекте 2 запрос на создание Magic Link будет одобрен.

Убедитесь, что в обоих проектах → Сеть → Magic Router на странице Соединения соединение MagicLink-1 отображается в статусе «Активно».

## 4. Настройте маршруты на Magic Router

При создании маршрутов на Magic Router необходимо указывать зону доступности, в которой расположена целевая подсеть.

1. В проекте 1 настройте маршруты на Magic Router:

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-1:

Адрес назначения: 10.1.1.0/24.
VPC: VPC-1.
Зона доступности: ru.AZ-1.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-2:

Адрес назначения: 10.3.3.0/24.
VPC: VPC-1.
Зона доступности: ru.AZ-2.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-3:

Адрес назначения: 10.2.2.0/24.
VPC: Magic Link.
Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 1 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».
2. В проекте 2 настройте маршруты на Magic Router:

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-1:

Адрес назначения: 10.1.1.0/24.
VPC: Magic Link.
Зона доступности: ru.AZ-1.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-2:

Адрес назначения: 10.3.3.0/24.
VPC: Magic Link.
Зона доступности: ru.AZ-2.

ПодсказкаМаршруты через Magic Link лучше создавать в зоне доступности, в которой находится подсеть назначения — подсеть проекта 2.В большинстве случаев связность появится независимо от того, в какой зоне доступности создан маршрут.
Но в таком случае возможна неоптимальная маршрутизация трафика.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-3:

Адрес назначения: 10.2.2.0/24.
VPC: VPC-2.
Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 2 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».

В проекте 1 настройте маршруты на Magic Router:

1. В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-1:

Адрес назначения: 10.1.1.0/24.
VPC: VPC-1.
Зона доступности: ru.AZ-1.
2. В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-2:

Адрес назначения: 10.3.3.0/24.
VPC: VPC-1.
Зона доступности: ru.AZ-2.
3. В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-3:

Адрес назначения: 10.2.2.0/24.
VPC: Magic Link.
Зона доступности: ru.AZ-1.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-1:

- Адрес назначения: 10.1.1.0/24.
- VPC: VPC-1.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.1.1.0/24.

VPC: VPC-1.

Зона доступности: ru.AZ-1.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-2:

- Адрес назначения: 10.3.3.0/24.
- VPC: VPC-1.
- Зона доступности: ru.AZ-2.

Адрес назначения: 10.3.3.0/24.

VPC: VPC-1.

Зона доступности: ru.AZ-2.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-3:

- Адрес назначения: 10.2.2.0/24.
- VPC: Magic Link.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.2.2.0/24.

VPC: Magic Link.

Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 1 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».

В проекте 2 настройте маршруты на Magic Router:

1. В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-1:

Адрес назначения: 10.1.1.0/24.
VPC: Magic Link.
Зона доступности: ru.AZ-1.
2. В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-2:

Адрес назначения: 10.3.3.0/24.
VPC: Magic Link.
Зона доступности: ru.AZ-2.

ПодсказкаМаршруты через Magic Link лучше создавать в зоне доступности, в которой находится подсеть назначения — подсеть проекта 2.В большинстве случаев связность появится независимо от того, в какой зоне доступности создан маршрут.
Но в таком случае возможна неоптимальная маршрутизация трафика.
3. В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-3:

Адрес назначения: 10.2.2.0/24.
VPC: VPC-2.
Зона доступности: ru.AZ-1.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-1:

- Адрес назначения: 10.1.1.0/24.
- VPC: Magic Link.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.1.1.0/24.

VPC: Magic Link.

Зона доступности: ru.AZ-1.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-2:

- Адрес назначения: 10.3.3.0/24.
- VPC: Magic Link.
- Зона доступности: ru.AZ-2.

Адрес назначения: 10.3.3.0/24.

VPC: Magic Link.

Зона доступности: ru.AZ-2.

Маршруты через Magic Link лучше создавать в зоне доступности, в которой находится подсеть назначения — подсеть проекта 2.

В большинстве случаев связность появится независимо от того, в какой зоне доступности создан маршрут.
Но в таком случае возможна неоптимальная маршрутизация трафика.

В сервисе Magic Router [создайте маршрут](https://cloud.ru/docs/magic-router/ug/topics/guides__routes-create)создайте маршрут к подсети subnet-3:

- Адрес назначения: 10.2.2.0/24.
- VPC: VPC-2.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.2.2.0/24.

VPC: VPC-2.

Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 2 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».

## 5. Настройте маршруты для VPC

При создании маршрутов в VPC необходимо указывать зону доступности, в которой расположена подсеть этой VPC.
Если в VPC созданы подсети в нескольких зонах доступности, маршруты необходимо создать в каждой зоне доступности.

1. В проекте 1 настройте маршруты для Evolution VPC:

В сервисе VPC выберите VPC-1.
[Создайте пользовательский маршрут](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-custom-route)Создайте пользовательский маршрут с параметрами:

Адрес назначения: 10.2.2.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-1.

Создайте еще один маршрут с параметрами:

Адрес назначения: 10.2.2.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-2.

Убедитесь, что в проекте 1 → Сеть → VPC на странице Маршруты для VPC-1 два маршрута отображаются в статусе «Активен».
2. В проекте 2 настройте маршруты для Evolution VPC:

В сервисе VPC выберите VPC-2.
[Создайте пользовательский маршрут](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-custom-route)Создайте пользовательский маршрут с параметрами:

Адрес назначения: 10.1.1.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-1.

Создайте еще один маршрут с параметрами:

Адрес назначения: 10.3.3.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 2 → Сеть → VPC на странице Маршруты для VPC-2 два маршрута отображаются в статусе «Активен».
ПодсказкаВ VPC можно создать один агрегированный маршрут 10.0.0.0/8 вместо всех более специфичных маршрутов.
Это не повлияет на маршрутизацию трафика к локальным подсетям в данной VPC.

В проекте 1 настройте маршруты для Evolution VPC:

1. В сервисе VPC выберите VPC-1.
2. [Создайте пользовательский маршрут](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-custom-route)Создайте пользовательский маршрут с параметрами:

Адрес назначения: 10.2.2.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-1.
3. Создайте еще один маршрут с параметрами:

Адрес назначения: 10.2.2.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-2.

В сервисе VPC выберите VPC-1.

[Создайте пользовательский маршрут](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-custom-route)Создайте пользовательский маршрут с параметрами:

- Адрес назначения: 10.2.2.0/24.
- Next Hop Type: Magic Router.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.2.2.0/24.

Next Hop Type: Magic Router.

Зона доступности: ru.AZ-1.

Создайте еще один маршрут с параметрами:

- Адрес назначения: 10.2.2.0/24.
- Next Hop Type: Magic Router.
- Зона доступности: ru.AZ-2.

Адрес назначения: 10.2.2.0/24.

Next Hop Type: Magic Router.

Зона доступности: ru.AZ-2.

Убедитесь, что в проекте 1 → Сеть → VPC на странице Маршруты для VPC-1 два маршрута отображаются в статусе «Активен».

В проекте 2 настройте маршруты для Evolution VPC:

1. В сервисе VPC выберите VPC-2.
2. [Создайте пользовательский маршрут](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-custom-route)Создайте пользовательский маршрут с параметрами:

Адрес назначения: 10.1.1.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-1.
3. Создайте еще один маршрут с параметрами:

Адрес назначения: 10.3.3.0/24.
Next Hop Type: Magic Router.
Зона доступности: ru.AZ-1.

В сервисе VPC выберите VPC-2.

[Создайте пользовательский маршрут](https://cloud.ru/docs/evolution-vpc/ug/topics/guides__add-custom-route)Создайте пользовательский маршрут с параметрами:

- Адрес назначения: 10.1.1.0/24.
- Next Hop Type: Magic Router.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.1.1.0/24.

Next Hop Type: Magic Router.

Зона доступности: ru.AZ-1.

Создайте еще один маршрут с параметрами:

- Адрес назначения: 10.3.3.0/24.
- Next Hop Type: Magic Router.
- Зона доступности: ru.AZ-1.

Адрес назначения: 10.3.3.0/24.

Next Hop Type: Magic Router.

Зона доступности: ru.AZ-1.

Убедитесь, что в проекте 2 → Сеть → VPC на странице Маршруты для VPC-2 два маршрута отображаются в статусе «Активен».

В VPC можно создать один агрегированный маршрут 10.0.0.0/8 вместо всех более специфичных маршрутов.
Это не повлияет на маршрутизацию трафика к локальным подсетям в данной VPC.

## 6. Настройте правила групп безопасности

1. В проекте 1 добавьте правила входящего трафика в группы безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2:

Выберите сервис Группы безопасности.
Для группы безопасности SSH-access_ru.AZ-1 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

Протокол: ICMP.
Тип источника: IP-адрес.
Источник: 0.0.0.0/0.

Для группы безопасности SSH-access_ru.AZ-2 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

Протокол: ICMP.
Тип источника: IP-адрес.
Источник: 0.0.0.0/0.

Убедитесь, что в проекте 1 → Сеть → Группы безопасности в группах безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.
2. В проекте 2 добавьте правила входящего трафика в группу безопасности SSH-access_ru.AZ-1:

Выберите сервис Группы безопасности.
Для группы безопасности SSH-access_ru.AZ-1 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

Протокол: ICMP.
Тип источника: IP-адрес.
Источник: 0.0.0.0/0.

Убедитесь, что в проекте 2 → Сеть → Группы безопасности в группе безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.

В проекте 1 добавьте правила входящего трафика в группы безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2:

1. Выберите сервис Группы безопасности.
2. Для группы безопасности SSH-access_ru.AZ-1 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

Протокол: ICMP.
Тип источника: IP-адрес.
Источник: 0.0.0.0/0.
3. Для группы безопасности SSH-access_ru.AZ-2 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

Протокол: ICMP.
Тип источника: IP-адрес.
Источник: 0.0.0.0/0.

Выберите сервис Группы безопасности.

Для группы безопасности SSH-access_ru.AZ-1 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

- Протокол: ICMP.
- Тип источника: IP-адрес.
- Источник: 0.0.0.0/0.

Протокол: ICMP.

Тип источника: IP-адрес.

Источник: 0.0.0.0/0.

Для группы безопасности SSH-access_ru.AZ-2 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

- Протокол: ICMP.
- Тип источника: IP-адрес.
- Источник: 0.0.0.0/0.

Протокол: ICMP.

Тип источника: IP-адрес.

Источник: 0.0.0.0/0.

Убедитесь, что в проекте 1 → Сеть → Группы безопасности в группах безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.

В проекте 2 добавьте правила входящего трафика в группу безопасности SSH-access_ru.AZ-1:

1. Выберите сервис Группы безопасности.
2. Для группы безопасности SSH-access_ru.AZ-1 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

Протокол: ICMP.
Тип источника: IP-адрес.
Источник: 0.0.0.0/0.

Выберите сервис Группы безопасности.

Для группы безопасности SSH-access_ru.AZ-1 [создайте правило](https://cloud.ru/docs/security-groups/ug/topics/guides__add-sg-rule)создайте правило для входящего трафика с параметрами:

- Протокол: ICMP.
- Тип источника: IP-адрес.
- Источник: 0.0.0.0/0.

Протокол: ICMP.

Тип источника: IP-адрес.

Источник: 0.0.0.0/0.

Убедитесь, что в проекте 2 → Сеть → Группы безопасности в группе безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.

## 7. Проверьте сетевую связность

1. Подключитесь к любой виртуальной машине [через виртуальную консоль](https://cloud.ru/docs/virtual-machines/ug/topics/guides__console)через виртуальную консоль.
2. Чтобы проверить сетевую связность с оставшимися виртуальными машинами, выполните команду:
ping <IP>

Где IP — IP-адрес виртуальной машины, с которой надо проверить сетевую связность.

Подключитесь к любой виртуальной машине [через виртуальную консоль](https://cloud.ru/docs/virtual-machines/ug/topics/guides__console)через виртуальную консоль.

Чтобы проверить сетевую связность с оставшимися виртуальными машинами, выполните команду:

```bash
ping
<
IP
>
```

Где IP — IP-адрес виртуальной машины, с которой надо проверить сетевую связность.

## Результат

Вы настроили связность между виртуальными машинами в разных VPC из разных проектов через Magic Link и получили опыт работы с соединениями, маршрутами и правилами групп безопасности.
