---
title: Настройка пайплайна CI/CD в GitHub, GitLab и GitVerse с использованием Artifact Registry
source: Cloud.ru Evolution Tutorials
url: https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd
topic: containers
---
# Настройка пайплайна CI/CD в GitHub, GitLab и GitVerse с использованием Artifact Registry

С помощью этого руководства вы научитесь создавать процесс автоматической сборки и публикации Docker-образа из системы контроля версий GitHub, GitLab или GitVerse в [Artifact Registry](https://cloud.ru/docs/artifact-registry-evolution/ug/index)Artifact Registry.
А также настроите автоматическое развертывание ревизии контейнера в [Container Apps](https://cloud.ru/docs/container-apps-evolution/ug/index)Container Apps.

Вы будете использовать следующие сервисы:

- [Artifact Registry](https://cloud.ru/docs/artifact-registry-evolution/ug/index)Artifact Registry для хранения, совместного использования и управления Docker-образами и Helm-чартами.
- [Container Apps](https://cloud.ru/docs/container-apps-evolution/ug/index)Container Apps — сервис для запуска контейнерных приложений в облаке. Не требует знания Kubernetes и создания виртуальных машин.
- Систему контроля версий: GitHub, GitLab или GitVerse.

[Artifact Registry](https://cloud.ru/docs/artifact-registry-evolution/ug/index)Artifact Registry для хранения, совместного использования и управления Docker-образами и Helm-чартами.

[Container Apps](https://cloud.ru/docs/container-apps-evolution/ug/index)Container Apps — сервис для запуска контейнерных приложений в облаке. Не требует знания Kubernetes и создания виртуальных машин.

Систему контроля версий: GitHub, GitLab или GitVerse.

Шаги:

1. [Подготовьте среду](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd)Подготовьте среду.
2. [Настройте пайплайн CI/CD в системе контроля версий](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd)Настройте пайплайн CI/CD в системе контроля версий.
3. [Настройте автоматическое развертывание контейнера](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd)Настройте автоматическое развертывание контейнера.

[Подготовьте среду](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd)Подготовьте среду.

[Настройте пайплайн CI/CD в системе контроля версий](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd)Настройте пайплайн CI/CD в системе контроля версий.

[Настройте автоматическое развертывание контейнера](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__ci-cd)Настройте автоматическое развертывание контейнера.

## Перед началом работы

[Зарегистрируйтесь в личном кабинете Cloud.ru](https://cloud.ru/docs/console/ug/topics/guides__registration)Зарегистрируйтесь в личном кабинете Cloud.ru.

Если вы уже зарегистрированы, [войдите под своей учетной записью](https://cloud.ru/docs/console/ug/topics/guides__auth)войдите под своей учетной записью.

## 1. Подготовьте среду

[Подготовьте среду](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__before-work)Подготовьте среду, если не сделали этого ранее.

## 2. Настройте пайплайн CI/CD в системе контроля версий

Вы можете создавать пайплайны непрерывной интеграции и непрерывного развертывания (CI/CD) с помощью [GitHub Actions](https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions)GitHub Actions.

1. Создайте аккаунт в [GitHub](https://github.com/)GitHub.
2. [Cделайте форк репозитория Cloud.ru с примером REST API](https://github.com/CLOUDdotRu/serverless-containers/tree/main)Cделайте форк репозитория Cloud.ru с примером REST API на языках Go, Python, C#, JavaScript.
Репозиторий содержит готовый код и Dockerfile для сборки Docker-образов приложений.
Образы подходят для запуска на платформе linux/amd64.
3. Перейдите в раздел Actions.
4. Нажмите кнопку New workflow и перейдите по ссылке Set up workflow youself.
Будет создан шаблон файла конфигурации в формате .yml в папке .gitub/workflows.
5. [Скопируйте код из репозитория Cloud.ru](https://github.com/CLOUDdotRu/serverless-containers/blob/main/.github/workflows/build-push-container-registry.yml)Скопируйте код из репозитория Cloud.ru и добавьте его в созданный YAML-файл.
Этот сценарий запускает создание Docker-образа и его загрузку в Artifact Registry.
6. В YAML‑файле в блоке env укажите URI реестра Artifact Registry в качестве значения ключа CR_URI.
Например, helloworld.cr.cloud.ru.
7. Перейдите в раздел Settings → Secrets and variables → Actions → Variables.
8. Укажите переменные и их значения, которые будут использоваться в команде docker login для аутентификации в Artifact Registry.
В нашем примере YAML‑файла это следующие переменные:

EVO_CR_LOGIN — логин персонального ключа доступа;
EVO_CR_PWD — пароль персонального ключа доступа.

Логин и пароль персонального ключа доступа вы получали [на этапе подготовки среды](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__before-work)на этапе подготовки среды.
9. После завершения редактирования YAML-файла зафиксируйте и отправьте изменения в свой репозиторий GitHub.
Коммит запустит пайплайн, каждый шаг которого будет выполняться в порядке, указанном в YAML‑файле.
10. Убедитесь, что все этапы выполнения сценария сборки завершились успешно.
В Artifact Registry вы должны увидеть загруженный образ.
При каждом изменении кода в GitHub обновленный образ будет автоматически отправляться в реестр Artifact Registry.
11. В [личном кабинете](https://console.cloud.ru/)личном кабинете перейдите в раздел Artifact Registry и убедитесь, что образ появился в реестре.

Создайте аккаунт в [GitHub](https://github.com/)GitHub.

[Cделайте форк репозитория Cloud.ru с примером REST API](https://github.com/CLOUDdotRu/serverless-containers/tree/main)Cделайте форк репозитория Cloud.ru с примером REST API на языках Go, Python, C#, JavaScript.

Репозиторий содержит готовый код и Dockerfile для сборки Docker-образов приложений.
Образы подходят для запуска на платформе linux/amd64.

Перейдите в раздел Actions.

Нажмите кнопку New workflow и перейдите по ссылке Set up workflow youself.

Будет создан шаблон файла конфигурации в формате .yml в папке .gitub/workflows.

[Скопируйте код из репозитория Cloud.ru](https://github.com/CLOUDdotRu/serverless-containers/blob/main/.github/workflows/build-push-container-registry.yml)Скопируйте код из репозитория Cloud.ru и добавьте его в созданный YAML-файл.

Этот сценарий запускает создание Docker-образа и его загрузку в Artifact Registry.

В YAML‑файле в блоке env укажите URI реестра Artifact Registry в качестве значения ключа CR_URI.
Например, helloworld.cr.cloud.ru.

Перейдите в раздел Settings → Secrets and variables → Actions → Variables.

Укажите переменные и их значения, которые будут использоваться в команде docker login для аутентификации в Artifact Registry.

В нашем примере YAML‑файла это следующие переменные:

- EVO_CR_LOGIN — логин персонального ключа доступа;
- EVO_CR_PWD — пароль персонального ключа доступа.

EVO_CR_LOGIN — логин персонального ключа доступа;

EVO_CR_PWD — пароль персонального ключа доступа.

Логин и пароль персонального ключа доступа вы получали [на этапе подготовки среды](https://cloud.ru/docs/tutorials-evolution/list/topics/container-apps__before-work)на этапе подготовки среды.

После завершения редактирования YAML-файла зафиксируйте и отправьте изменения в свой репозиторий GitHub.

Коммит запустит пайплайн, каждый шаг которого будет выполняться в порядке, указанном в YAML‑файле.

Убедитесь, что все этапы выполнения сценария сборки завершились успешно.

В Artifact Registry вы должны увидеть загруженный образ.

При каждом изменении кода в GitHub обновленный образ будет автоматически отправляться в реестр Artifact Registry.

В [личном кабинете](https://console.cloud.ru/)личном кабинете перейдите в раздел Artifact Registry и убедитесь, что образ появился в реестре.

[Синтаксис YAML для GitHub Actions](https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions)Синтаксис YAML для GitHub Actions

## 3. Настройте автоматическое развертывание контейнера

Чтобы каждый раз после загрузки в реестр обновленного Docker-образа автоматически создавалась новая ревизия контейнера:

1. В Artifact Registry откройте меню загруженного образа и нажмите Создать Container App.
2. Заполните поля и активируйте опции:

Название контейнера — глобально уникальное имя, на базе которого формируется адрес вашего приложения в домене *.containers.cloud.ru.
Порт контейнера — порт контейнера, который должен совпадать с портом вашего приложения.
В этом сценарии используем порт 8080.
vCPU/RAM — количество vCPU и RAM, которые выделяются для каждого экземпляра контейнера при обработке вызова.
Выберите минимальную конфигурацию.
Минимальное и максимальное количество экземпляров при масштабировании сервиса. По умолчанию происходит масштабирование с 0, что может вызывать небольшую задержку при старте вашего приложения. Установите минимальное количество экземпляров — 0, а максимальное — 1.
Публичный адрес — активируйте опцию, чтобы получить URL-адрес для вызова приложения из интернета.
Автоматическое развертывание — активируйте опцию, чтобы каждый раз после загрузки в Artifact Registry новой версии образа на стороне Container Apps автоматически создавалась новая ревизия контейнера.
3. Нажмите Создать.

В Artifact Registry откройте меню загруженного образа и нажмите Создать Container App.

Заполните поля и активируйте опции:

- Название контейнера — глобально уникальное имя, на базе которого формируется адрес вашего приложения в домене *.containers.cloud.ru.
- Порт контейнера — порт контейнера, который должен совпадать с портом вашего приложения.
В этом сценарии используем порт 8080.
- vCPU/RAM — количество vCPU и RAM, которые выделяются для каждого экземпляра контейнера при обработке вызова.
Выберите минимальную конфигурацию.
- Минимальное и максимальное количество экземпляров при масштабировании сервиса. По умолчанию происходит масштабирование с 0, что может вызывать небольшую задержку при старте вашего приложения. Установите минимальное количество экземпляров — 0, а максимальное — 1.
- Публичный адрес — активируйте опцию, чтобы получить URL-адрес для вызова приложения из интернета.
- Автоматическое развертывание — активируйте опцию, чтобы каждый раз после загрузки в Artifact Registry новой версии образа на стороне Container Apps автоматически создавалась новая ревизия контейнера.

Название контейнера — глобально уникальное имя, на базе которого формируется адрес вашего приложения в домене *.containers.cloud.ru.

Порт контейнера — порт контейнера, который должен совпадать с портом вашего приложения.
В этом сценарии используем порт 8080.

vCPU/RAM — количество vCPU и RAM, которые выделяются для каждого экземпляра контейнера при обработке вызова.
Выберите минимальную конфигурацию.

Минимальное и максимальное количество экземпляров при масштабировании сервиса. По умолчанию происходит масштабирование с 0, что может вызывать небольшую задержку при старте вашего приложения. Установите минимальное количество экземпляров — 0, а максимальное — 1.

Публичный адрес — активируйте опцию, чтобы получить URL-адрес для вызова приложения из интернета.

Автоматическое развертывание — активируйте опцию, чтобы каждый раз после загрузки в Artifact Registry новой версии образа на стороне Container Apps автоматически создавалась новая ревизия контейнера.

Нажмите Создать.

Откроется страница сервиса Container Apps.
Контейнер будет запущен в течение нескольких секунд.

Дождитесь, когда контейнер и ревизия перейдут в статус «Выполняется».

Теперь при каждом изменении кода в системе CI/CD обновленный образ будет автоматически отправляться в реестр Artifact Registry, а на стороне Container Apps будет автоматически создаваться новая ревизия контейнера.

## Результат

Вы создали процесс автоматической сборки и публикации Docker-образа с помощью GitHub, GitLab, GitVerse и Artifact Registry, а также настроили автоматическое развертывание ревизии контейнера из обновленного образа.
